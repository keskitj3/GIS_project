<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>GIS_project</title>
    <script type='text/javascript' src='http://www.openlayers.org/api/OpenLayers.js'></script>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="http://openlayers.org/en/v3.9.0/css/ol.css" type="text/css">
    <script src="http://openlayers.org/en/v3.9.0/build/ol.js"></script>
    <style>
    	#header {
    background-color:#006600;
    color:black;
    text-align:center;
    width:100%;
      	}
	#nav {
    line-height:30px;
    background-color:#00CC00;
    height:500px;
    width:10%;
    float:left;
	}
	#footer {
    background-color:#006600;
    color:black;
    clear:both;
    text-align:left;
    width:100%;
	</style>
  </head>
  
  <body>
    
    <!-- Header osio, johon tulee otsikko ja ehka joki valikko -->
    <div id="header">
    <h1>Liikuntapaikat kartalla</h1>
    </div>
    
    <!-- Sivupalkki -->
    <div id="nav">
    <button type="button" onclick="alert('Doesn't work yet');">Find route</button>
    <button type="button" onclick="alert('Doesn't work yet');">Analyze</button>
    </div>
  
    <!-- Tassa osiossa luodaan kartta ja lisataan siihen funktiot -->
    <section class="main-content">
      
      <!-- Lisaa kartan halutulla koolla -->
      <div id="map" style="height:500px; width:90%"></div>
      
      <!-- Tassa scriptissa luodaan kaikki kartassa esiintyvat funktiot ja tyokalut -->
      <script>
      
      
var map = new OpenLayers.Map({
    target: 'map',
    layers: [
        new ol.layer.Tile({
            source: new ol.source.OSM()
        })
    ],
    view: new OpenLayers.View({
        center: OpenlLayers.proj.transform([-0.92, 52.96], 'EPSG:4326', 'EPSG:3857'),
        zoom: 6
    })
});
      
        // Luo kartan, jossa on navigointi mahdollisuus
        /*map = new OpenLayers.Map("map", 
        	{units:'m',
		controls: [new OpenLayers.Control.Navigation()]
        	},
        	overlays: [overlay],
        	target: 'map');
          
        var map = new ol.Map({
  	layers: [
    	new ol.layer.Tile({
	 source: new ol.source.TileJSON({
	 url: 'http://api.tiles.mapbox.com/v3/' +
            'mapbox.natural-earth-hypso-bathy.jsonp',
        crossOrigin: 'anonymous'
      })
    })
  ],
  renderer: exampleNS.getRendererFromQueryString(),
  overlays: [overlay],
  target: 'map',
  view: new ol.View({
    center: [0, 0],
    zoom: 2
  })
});  	
        
        // Lisaa openstreetmapin layeriksi
        OSMmap = new OpenLayers.Layer.OSM();*/
	// http://localhost:8080/geoserver/GIS_project/wms, GIS_project:lipas_kaikki_pisteet
	// Luodaan WMS taso, kutsumalla se geoserverilta. Samalla asetetaan sille halutut parametrit
        var wms = new OpenLayers.Layer.WMS("Liikuntapaikat", "http://130.233.249.20:8080/geoserver/WMS/wms",
        	{layers: "WMS:wms-testi",
        	transparent: true,
        	format: 'image/png'},
        	{'opacity': 0.66, 'isBaseLayer': false, projection: 'EPSG:900913'});
	var vaesto = new OpenLayers.Layer.WMS("Vaesto", "http://130.233.249.20:8080/geoserver/WMS/wms",
        	{layers: "WMS:vaki2014_1km",
        	transparent: true,
        	format: 'image/png'},
        	{'opacity': 0.66, 'isBaseLayer': false, projection: 'EPSG:900913'});
        	
        var vaesto_kp = new OpenLayers.Layer.WMS("Vaesto_kp", "http://130.233.249.20:8080/geoserver/WMS/wms",
        	{layers: "WMS:vaki2014_1km_kp",
        	transparent: true,
        	format: 'image/png'},
        	{'opacity': 0.66, 'isBaseLayer': false, projection: 'EPSG:900913'}); 
	
        // Lisaa WFS tason, mutta jostai syysta se ei toimi :(
	var wfs = new OpenLayers.Layer.Vector("WFS", {
		strategies: [new OpenLayers.Strategy.Fixed()],
		protocol: new OpenLayers.Protocol.WFS({
			version: "1.1.0",
			url: "http://130.233.249.20:8080/geoserver/wfs",
			featureType: "WMS:WFS_pisteet",
			featureNS: "http://130.233.249.20",
			geometryName: "point"})
		});
	
        
	// Lisataan aikasemmin luodut tasot kartalle
        map.addLayers([OSMmap, wms, wfs]);
        
        // Asetetaan perusnakyman parametrit eli sijainti ja zoomaus taso
        var lat = 60.170833;
        var lon = 24.9375;
        var zoom = 14;
      
      	// Lisaa merkintakuviot yhdeksi tasoksi
        var markers = new OpenLayers.Layer.Markers( "Markers" );
        map.addLayer(markers);
      
        // Etsii kayttajan sijainnin ja tallentaa sen Location nimiseen elementtiin, jota voidaan kutsua universaalisti
        navigator.geolocation.getCurrentPosition(function(position) {
      	  	document.getElementById('Location').innerHTML= 
      	  	" Latitude: " + position.coords.latitude + 
      	  	" Longitude: " + position.coords.longitude;
      		
      		// Tallentaa koordinaatit lonlat muuttujaan
      		var lonLat = new OpenLayers.LonLat(position.coords.longitude, position.coords.latitude)
      		.transform(new OpenLayers.Projection("EPSG:4326"), // Muuttaa koordinaatiston WGS 1984:sta EPSG 4326:n
      		
      		map.getProjectionObject()); // to Spherical Mercator Projection
      		markers.addMarker(new OpenLayers.Marker(lonLat)); // Lisaa markkerin haetulle sijainnille
        	map.setCenter(lonLat, zoom); // Asettaa kartan kyseiselle sijainnille
        });
      
      	// Lisataan kartalle muutamat tarkeat controllit
        map.addControl(new OpenLayers.Control.LayerSwitcher());
        map.addControl(new OpenLayers.Control.ScaleLine());
        map.addControl(new OpenLayers.Control.MousePosition());
        map.addControl(new OpenLayers.Control.PanZoomBar());
        
        //tehdaan popup
       
/**
 * Add a click handler to the map to render the popup.
 */
map.on('singleclick', function(evt) {
  var coordinate = evt.coordinate;
  var hdms = ol.coordinate.toStringHDMS(ol.proj.transform(
      coordinate, 'EPSG:3857', 'EPSG:4326'));

  content.innerHTML = '<p>You clicked here:</p><code>' + hdms +
      '</code>';
  overlay.setPosition(coordinate);
});
        
      </script>
      
      <!-- Sijoittaa sijannin funktiosta sivulle haluttuun paikkaan -->
      <p id="Location"></p>
      
      <!-- Tahan voidaan laittaa sivun alaosan tietoja, kuten tekijat ja copyright merkinnat -->
      <div id=footer>
      	<p>GIS Software Development course</p>
      </div>

    </section>
  </body>
</html>
